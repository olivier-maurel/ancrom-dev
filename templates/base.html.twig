<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text></svg>">
        <link href="{{ asset('css/framework.css') }}" rel="stylesheet" type="text/css">
        <!-- <link href="{{ asset('css/plugins.css') }}" rel="stylesheet" type="text/css"> -->
        <link href="{{ asset('css/widgets.css') }}" rel="stylesheet" type="text/css">
        <link href="{{ asset('css/style.css') }}" rel="stylesheet" type="text/css">
        <link href="{{ asset('css/font-icons.min.css') }}" rel="stylesheet" type="text/css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
		<link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
		<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

        {# Run `composer require symfony/webpack-encore-bundle` to start using Symfony UX #}
        {% block stylesheets %}
            {{ encore_entry_link_tags('app') }}
        {% endblock %}

        {% block javascripts %}
            {{ encore_entry_script_tags('app') }}
        {% endblock %}
    </head>
    <body id="kt_body" class="toolbar-enabled overflow-hidden" data-kt-sticky-header="on" data-kt-header="on" data-kt-scrolltop="on" data-float-page="off">        
        <div id="container" class="d-flex flex-column flex-root">
			<!--begin::Page-->
			<div class="page d-flex flex-column flex-column-fluid">
				
				<!--begin::Wrapper-->
				<div class="wrapper d-flex flex-column flex-row-fluid container-xxl h-100 align-items-center justify-content-end " id="kt_wrapper">
					<!--begin::Main-->
					<div class="topbar py-2 d-flex align-items-stretch flex-shrink-0" id="kt_topbar">
						<!--begin::Activities-->
						<div class="d-flex align-items-center mx-4 mx-lg-5">
							<!--begin::Drawer toggle-->
							<a class="btn btn-icon btn-custom w-lg-50px h-lg-50px w-50px h-50px w-sm-90px h-sm-90px flex-column" data-page="profil" data-pos="left" id="kt_activities_toggle">
								<!--begin::Svg Icon | path: icons/duotune/general/gen032.svg-->
								<span class="svg-icon svg-icon-1 d-flex align-items-center flex-column">
									<i class="fa fa-user"></i>
								</span>
								<span class="focus">●</span>
								<!--end::Svg Icon-->
							</a>
							<!--end::Drawer toggle-->
						</div>
						<!--end::Activities-->
						<!--begin::Activities-->
						<div class="d-flex align-items-center  mx-4 mx-lg-5">
							<!--begin::Drawer toggle-->
							<a class="btn btn-icon btn-custom w-lg-50px h-lg-50px w-50px h-50px w-sm-90px h-sm-90px" data-page="project" data-pos="bottom" id="kt_activities_toggle">
								<!--begin::Svg Icon | path: icons/duotune/general/gen032.svg-->
								<span class="svg-icon svg-icon-1 d-flex align-items-center flex-column">
									<i class="fa fa-flask"></i>
								</span>
								<span class="focus">●</span>
								<!--end::Svg Icon-->
							</a>
							<!--end::Drawer toggle-->
						</div>
						<!--end::Activities-->
						<!--begin::Activities-->
						<div class="d-flex align-items-center  mx-4 mx-lg-5">
							<!--begin::Drawer toggle-->
							<a class="btn btn-icon btn-custom w-lg-50px h-lg-50px w-50px h-50px w-sm-90px h-sm-90px" data-page="contact" data-pos="right" id="kt_activities_toggle">
								<!--begin::Svg Icon | path: icons/duotune/general/gen032.svg-->
								<span class="svg-icon svg-icon-1 d-flex align-items-center flex-column">
									<i class="fa fa-envelope"></i>
								</span>
								<span class="focus">●</span>
								<!--end::Svg Icon-->
							</a>
							<!--end::Drawer toggle-->
						</div>
						<!--end::Activities-->
					</div>
					<!--end::Main-->
				</div>
				<!--end::Wrapper-->
			</div>
			<!--end::Page-->
			<div id="profil" class="page d-flex flex-column flex-column-fluid float-page float-page-left col-lg-8 m-auto">
				<div class="col-lg-8 m-auto">

				</div>
			</div>
			<div id="contact" class="page d-flex flex-column flex-column-fluid float-page float-page-right col-lg-8 m-auto">
				<div class="col-lg-8 m-auto">

				</div>
			</div>
			<div id="project" class="page d-flex flex-column flex-column-fluid float-page float-page-bottom col-lg-8 m-auto">
				<div class="col-lg-8 m-auto">

				</div>
			</div>
			<div class="position-fixed d-flex justify-content-between top-0 start-0 w-100" style="height: 30px;background-color: rgba(61, 61, 61, 0.904);">
				<div class="col-4">
					<a href="#" class="btn" data-page="index">
						Cancel
					</a>
				</div>
				<div class="col-4 d-flex justify-content-center align-items-center">
					<span id="datetime" class="btn btn-sm btn-os text-white-soft text-code fw-bold" style="white-space:pre;"></span>
				</div>
				<div class="col-4"></div>
			</div>
			<div id="mapctrl" class="text-code float-page init-page text-white d-none" style="background-color: #0003;">
				<div class="d-flex flex-column justify-content-center align-items-center h-100 overflow-hidden">
					<h1>TUTORIAL PLAN SITE</h1>
					<div class="d-flex flex-column">
						<div class="col-12 d-flex">
							<div class="window" data-pos="left">Profil</div>
							<div class="window window-active" data-pos="off"></div>
							<div class="window" data-pos="right">Contact</div>
						</div>
						<div class="col-12 d-flex justify-content-center">
							<div class="window" data-pos="bottom">Projets</div>
						</div>
					</div>
				</div>
			</div>
		</div>
        <script src="{{ asset('js/framework.js') }}"></script>
        <script src="{{ asset('js/plugins.js') }}"></script>
		<script>
			function returnCenterPage() {
				$('body').attr('data-float-page', 'off');
				$('.float-page-center').removeClass('float-page-center');
				$('a[data-page]').removeClass('btn-active');
				$('.window[data-pos]').removeClass('window-active');
				$('.window[data-pos=off]').addClass('window-active');
				$('body').removeClass(function (index, css) {
					return (css.match (/\bbg-pos-\S+/g) || []).join(' '); // removes anything that starts with "page-"
				});
			}
			function eventKeyUp(e) {

				if (e.keyCode === 27 || e.keyCode === 38 && $('#project').hasClass('float-page-center') === true) // Escape
				 	returnCenterPage();

				if (!e.ctrlKey) 
					return;
				else if (e.keyCode === 37) // Left
					if ($('body').attr('data-float-page') === 'right')
						returnCenterPage();
					else
						$('a[data-pos=left]').first().click();
				else if (e.keyCode === 39) // Right
					if ($('body').attr('data-float-page') === 'left')
						returnCenterPage();
					else
						$('a[data-pos=right]').first().click();
				else if (e.keyCode === 40 ) // Bottom && $('#profil').hasClass('float-page-center') === false && $('#contact').hasClass('float-page-center') === false
					$('a[data-pos=bottom]').first().click();
			}
			function setDatetime() {
				var dt = new Date();
				let time = new Intl.DateTimeFormat('us-US', {hour: 'numeric', minute: 'numeric'}).format(dt);
				let month = new Intl.DateTimeFormat('us-US', {month: 'short'}).format(dt);
				let text = month+' '+dt.getDate()+"     "+time;
				if (text !== $('#datetime').text())
					$('#datetime').html(text);
			}

			$('a[data-page]').on('click', function(){

				let page = $(this).data('page');
				let position = $(this).data('pos');
				
				console.log($('body').attr('data-float-page') === position);
				if ($('body').attr('data-float-page') === position) {
					$('.window[data-pos]').removeClass('window-active');
					$('.window[data-pos=off]').addClass('window-active');
					$(this).removeClass('btn-active');
				} else {
					$('.window[data-pos]').removeClass('window-active');
					$('.window[data-pos='+position+']').addClass('window-active');
					$('a[data-page]').removeClass('btn-active');
					$(this).addClass('btn-active');
				}
					

				if ($('body').attr('data-float-page') !== 'on' && $('#'+$(this).data('page')).hasClass('float-page-center'))
						return returnCenterPage();

				$.get("{{ path('app_change_page') }}", {page: $(this).data('page')}, function(data){
					if (data.html !== false)
						$('#'+page).find('div').html(data.html);

					$('.float-page').removeClass('float-page-center');
					$('#'+page).addClass('float-page-center');
					$('body').removeClass(function (index, css) {
						return (css.match (/\bbg-pos-\S+/g) || []).join(' '); // removes anything that starts with "page-"
					});
					$('body').attr('data-float-page', position).addClass('bg-pos-'+position);
					
					
				});

			});

			$(document.body).on('keyup', function(e){
				eventKeyUp(e);
			});

			let timer = 0;
			$(document.body).on("keydown",function(e){
				clearTimeout(timer);
				if (!e.ctrlKey) return;
				timer = setTimeout(function(){
					$('#mapctrl').removeClass('d-none');
				},600);
			}).on("keyup",function(e){
				clearTimeout(timer);
				if (e.keyCode === 17)
				$('#mapctrl').addClass('d-none');
			});

			setDatetime();
			setInterval(function(){
				setDatetime();
			}, 3000);

			
			$(document.body).on('click', 'span.flatpickr-day', function(){
				$('.flatpickr-calendar').first().addClass('open');
			});
			flatpickr("#datetime", {
				position: 'auto center', 
				onOpen: function(){
					$('#datetime').on('click', function(){
						if ($(this).hasClass('flatpickr-input active')) {
							$('.flatpickr-calendar').first().removeClass('open');
							$(this).removeClass('active');
						} else {
							$('.flatpickr-calendar').first().addClass('open');
							$(this).addClass('active');
						}
					});
					$('.flatpickr-day').on('click', function(e){
						e.stopPropagation();
					});
				},
				monthSelectorType: 'static',
			});
			
		</script>
    </body>
</html>
